# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  # Base box
  config.vm.box = "generic/ubuntu2204"

  # Global provider configuration
  config.vm.provider :libvirt do |libvirt|
    libvirt.driver = "kvm"
  end

  # SSH settings â€” use default Vagrant key
  config.ssh.insert_key = false
  config.ssh.username = "vagrant"
  config.ssh.password = "vagrant"
  config.ssh.private_key_path = "~/.vagrant.d/insecure_private_key"

  # Boot timeout (Ubuntu cloud-init can be slow)
  config.vm.boot_timeout = 600

  # --- Master node ---
  config.vm.define "master" do |master|
    master.vm.hostname = "master"
    master.vm.network :private_network,
      libvirt__network_name: "default",
      libvirt__dhcp_enabled: true

    master.vm.provider :libvirt do |libvirt|
      libvirt.memory = 4096
      libvirt.cpus   = 2
    end

    # Install Python3 (for Ansible/Kubespray)
    master.vm.provision "shell", inline: <<-SHELL
      apt-get update -y
      apt-get install -y python3 python3-apt
    SHELL
  end

  # --- Worker 1 ---
  config.vm.define "worker1" do |worker1|
    worker1.vm.hostname = "worker1"
    worker1.vm.network :private_network,
      libvirt__network_name: "default",
      libvirt__dhcp_enabled: true

    worker1.vm.provider :libvirt do |libvirt|
      libvirt.memory = 2048
      libvirt.cpus   = 2
    end

    worker1.vm.provision "shell", inline: <<-SHELL
      apt-get update -y
      apt-get install -y python3 python3-apt
    SHELL
  end

  # --- Worker 2 ---
  config.vm.define "worker2" do |worker2|
    worker2.vm.hostname = "worker2"
    worker2.vm.network :private_network,
      libvirt__network_name: "default",
      libvirt__dhcp_enabled: true

    worker2.vm.provider :libvirt do |libvirt|
      libvirt.memory = 2048
      libvirt.cpus   = 2
    end

    worker2.vm.provision "shell", inline: <<-SHELL
      apt-get update -y
      apt-get install -y python3 python3-apt
    SHELL
  end
end

